from pymongo import MongoClient
import numpy as np
import matplotlib.pyplot as plt
from pymongo import MongoClient

MONGO_HOST= 'mongodb://localhost/twitter_db' 
client = MongoClient(MONGO_HOST)
db = client.twitter_db

#Counting the tweets collected through different methods
print("Total amount of combined tweets collected through 1%, Keyword-based, user-based and location-based(Glasgow):")
print(db.twitter_search1.count()+db.twitter_search2.count()+db.twitter_search3.count()+db.twitter_search4.count())
print("Total amount of tweets collected through 1% streaming:")
print(db.twitter_search1.count())
print("Total amount of geo-tagged data collected through 1% streaming:")
print(db.twitter_search1.find({"user.geo_enabled":{"$eq":True}}).count())
print("Tweets collected from Glasgow through 1% streaming:")
print(db.twitter_search1.find( { "place.name" : { "$eq":"Glasgow" } } ).count())
print("Total amount of tweets collected through keyword-based streaming:")
print(db.twitter_search2.count())
print("Total amount of geo-tagged data collected through keyword-based streaming:")
#print(db.twitter_search2.find({"user.geo_enabled":{"$eq":True}}).count()) #Not always contain geo-information even if geo-enabled is true.
print(db.twitter_search2.find({"place":{"$ne":None}}).count())
print("Tweets collected from Glasgow through keyword-based streaming:")
print(db.twitter_search2.find( { "place.name" : { "$eq":"Glasgow" } } ).count())
print("Total amount of tweets collected through location-based search:")
print(db.twitter_search3.count())
print("Tweets collected from Glasgow through location-based streaming:")
print(db.twitter_search3.find( { "place.name" : { "$eq":"Glasgow" } } ).count())
print("Total amount of tweets collected through user-based REST API:")
print(db.twitter_search4.count())
print("Total amount of geo-tagged data collected through user-based streaming:")
print(db.twitter_search4.find({"place":{"$ne":None}}).count())
print("Tweets collected from Glasgow through user-based streaming:")
print(db.twitter_search4.find( { "place.name" : { "$eq":"Glasgow" } } ).count())
print("Number of retweets collected:")
r1 = db.twitter_search1.find({"retweeted_status":{"$exists":True}}).count()
r2 = db.twitter_search2.find({"retweeted_status":{"$exists":True}}).count()
r3 = db.twitter_search3.find({"retweeted_status":{"$exists":True}}).count()
r4 = db.twitter_search4.find({"retweeted_status":{"$exists":True}}).count()
print(r1+r2+r3+r4)
print("Number of quotes collected:")
q1 = db.twitter_search1.find({"is_quote_status":{"$eq":True}}).count()
q2 = db.twitter_search2.find({"is_quote_status":{"$eq":True}}).count()
q3 = db.twitter_search3.find({"is_quote_status":{"$eq":True}}).count()
q4 = db.twitter_search4.find({"is_quote_status":{"$eq":True}}).count()
print(q1+q2+q3+q4)

#querying the databases to count the number of tweets in 10 minute intervals from all the collections except for the user-based one
query1 =db.twitter_search1.find({"timestamp_ms":{"$lt":"1542319627000"}}).count()
query2 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542319627000"}},{"timestamp_ms":{"$lt":"1542320227000"}}]}).count()
query3 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542320227000"}},{"timestamp_ms":{"$lt":"1542320827000"}}]}).count()
query4 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542320827000"}},{"timestamp_ms":{"$lt":"1542321427000"}}]}).count()
query5 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542321427000"}},{"timestamp_ms":{"$lt":"1542322027000"}}]}).count()
query6 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542322027000"}},{"timestamp_ms":{"$lt":"1542322637000"}}]}).count()
query7 =db.twitter_search2.find({"timestamp_ms":{"$lt":"1542319627000"}}).count()
query8 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542319627000"}},{"timestamp_ms":{"$lt":"1542320227000"}}]}).count()
query9 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542320227000"}},{"timestamp_ms":{"$lt":"1542320827000"}}]}).count()
query10 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542320827000"}},{"timestamp_ms":{"$lt":"1542321427000"}}]}).count()
query11 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542321427000"}},{"timestamp_ms":{"$lt":"1542322027000"}}]}).count()
query12 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542322027000"}},{"timestamp_ms":{"$lt":"1542322637000"}}]}).count()
query13 =db.twitter_search3.find({"timestamp_ms":{"$lt":"1542323257000"}}).count()
query14=db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542323257000"}},{"timestamp_ms":{"$lt":"1542323857000"}}]}).count()
query15=db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542323857000"}},{"timestamp_ms":{"$lt":"1542324457000"}}]}).count()
query16 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542324457000"}},{"timestamp_ms":{"$lt":"1542325057000"}}]}).count()
query17 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542325057000"}},{"timestamp_ms":{"$lt":"1542325657000"}}]}).count()
query18 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542325657000"}},{"timestamp_ms":{"$lt":"1542326258000"}}]}).count()

#adding the count of data collected from 0 to 60 minutes
x = np.array([query1+query7+query13,query2+query8+query14,query3+query9+query15,query4+query10+query16,query5+query11+query17,query6+query12+query18])
y = np.array(["10","20","30","40","50","60"])

#Plotting the total amount of data collected vs time intervals of 10 minutes
fig=plt.figure()
ax=fig.add_subplot(1,1,1)
ax.set_title("10 minutes interval graph for the number of tweets collected")
ax.set_xlabel("Time in minutes")
ax.set_ylabel("Number of tweets collected")
plt.plot(y,x,marker="o",markersize=10)
plt.show()

#Plotting the total amount of geo-tagged data collected from Glasgow vs time intervals of 10 minutes
x1 = np.array([query13,query14,query15,query16,query17,query18])
y1 = np.array(["10","20","30","40","50","60"])
fig=plt.figure()
ax=fig.add_subplot(1,1,1)
ax.set_title("10 minutes interval graph for the number of tweets collected")
ax.set_xlabel("Time in minutes")
ax.set_ylabel("Number of tweets collected")
plt.plot(y1,x1,marker="o",markersize=10)
plt.show()

#querying the databases to count the number of retweets in 10 minute intervals from all the collections
rquery1 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$lt":"1542319627000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery2 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542319627000"}},{"timestamp_ms":{"$lt":"1542320227000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery3 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542320227000"}},{"timestamp_ms":{"$lt":"1542320827000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery4 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542320827000"}},{"timestamp_ms":{"$lt":"1542321427000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery5 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542321427000"}},{"timestamp_ms":{"$lt":"1542322027000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery6 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542322027000"}},{"timestamp_ms":{"$lt":"1542322637000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery7 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$lt":"1542319627000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery8 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542319627000"}},{"timestamp_ms":{"$lt":"1542320227000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery9 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542320227000"}},{"timestamp_ms":{"$lt":"1542320827000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery10 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542320827000"}},{"timestamp_ms":{"$lt":"1542321427000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery11 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542321427000"}},{"timestamp_ms":{"$lt":"1542322027000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery12 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542322027000"}},{"timestamp_ms":{"$lt":"1542322637000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery13 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$lt":"1542323257000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery14=db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542323257000"}},{"timestamp_ms":{"$lt":"1542323857000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery15=db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542323857000"}},{"timestamp_ms":{"$lt":"1542324457000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery16 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542324457000"}},{"timestamp_ms":{"$lt":"1542325057000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery17 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542325057000"}},{"timestamp_ms":{"$lt":"1542325657000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery18 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542325657000"}},{"timestamp_ms":{"$lt":"1542326258000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery19 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$lt":"1542323257000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery20=db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542323257000"}},{"timestamp_ms":{"$lt":"1542323857000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery21=db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542323857000"}},{"timestamp_ms":{"$lt":"1542324457000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery22 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542324457000"}},{"timestamp_ms":{"$lt":"1542325057000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery23 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542325057000"}},{"timestamp_ms":{"$lt":"1542325657000"}},{"retweeted_status":{"$exists":True}}]}).count()
rquery24 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542325657000"}},{"timestamp_ms":{"$lt":"1542326258000"}},{"retweeted_status":{"$exists":True}}]}).count()

#adding the count of retweets collected from 0 to 60 minutes
x2 = np.array([rquery1+rquery7+rquery13+rquery19,rquery2+rquery8+rquery14+rquery20,rquery3+rquery9+rquery15+rquery21,rquery4+rquery10+rquery16+rquery22,rquery5+rquery11+rquery17+rquery23,rquery6+rquery12+rquery18+rquery24])
y2 = np.array(["10","20","30","40","50","60"])

#Plotting the total amount of retweets collected vs time intervals of 10 minutes
fig=plt.figure()
ax=fig.add_subplot(1,1,1)
ax.set_title("10 minutes interval graph for the number of retweets collected")
ax.set_xlabel("Time in minutes")
ax.set_ylabel("Number of retweets collected")
plt.plot(y2,x2,marker="o",markersize=10)
plt.show()

#querying the databases to count the number of quotes in 10 minute intervals from all the collections
qquery1 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$lt":"1542319627000"}},{"is_quote_status":{"$exists":True}}]}).count()
qquery2 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542319627000"}},{"timestamp_ms":{"$lt":"1542320227000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery3 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542320227000"}},{"timestamp_ms":{"$lt":"1542320827000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery4 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542320827000"}},{"timestamp_ms":{"$lt":"1542321427000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery5 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542321427000"}},{"timestamp_ms":{"$lt":"1542322027000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery6 =db.twitter_search1.find({"$and":[{"timestamp_ms":{"$gt":"1542322027000"}},{"timestamp_ms":{"$lt":"1542322637000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery7 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$lt":"1542319627000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery8 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542319627000"}},{"timestamp_ms":{"$lt":"1542320227000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery9 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542320227000"}},{"timestamp_ms":{"$lt":"1542320827000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery10 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542320827000"}},{"timestamp_ms":{"$lt":"1542321427000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery11 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542321427000"}},{"timestamp_ms":{"$lt":"1542322027000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery12 =db.twitter_search2.find({"$and":[{"timestamp_ms":{"$gt":"1542322027000"}},{"timestamp_ms":{"$lt":"1542322637000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery13 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$lt":"1542323257000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery14=db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542323257000"}},{"timestamp_ms":{"$lt":"1542323857000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery15=db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542323857000"}},{"timestamp_ms":{"$lt":"1542324457000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery16 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542324457000"}},{"timestamp_ms":{"$lt":"1542325057000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery17 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542325057000"}},{"timestamp_ms":{"$lt":"1542325657000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery18 =db.twitter_search3.find({"$and":[{"timestamp_ms":{"$gt":"1542325657000"}},{"timestamp_ms":{"$lt":"1542326258000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery19 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$lt":"1542323257000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery20=db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542323257000"}},{"timestamp_ms":{"$lt":"1542323857000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery21=db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542323857000"}},{"timestamp_ms":{"$lt":"1542324457000"}},{"is_quote_status":{"$eq":True}}]}).count()
qquery22 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542324457000"}},{"timestamp_ms":{"$lt":"1542325057000"}},{"is_quote_status":{"$exists":True}}]}).count()
qquery23 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542325057000"}},{"timestamp_ms":{"$lt":"1542325657000"}},{"is_quote_status":{"$exists":True}}]}).count()
qquery24 =db.twitter_search4.find({"$and":[{"timestamp_ms":{"$gt":"1542325657000"}},{"timestamp_ms":{"$lt":"1542326258000"}},{"is_quote_status":{"$eq":True}}]}).count()

#adding the count of quotes collected from 0 to 60 minutes
x3 = np.array([qquery1+qquery7+qquery13+qquery19,qquery2+qquery8+qquery14+qquery20,qquery3+qquery9+qquery15+qquery21,qquery4+qquery10+qquery16+qquery22,qquery5+qquery11+qquery17+qquery23,qquery6+qquery12+qquery18+qquery24])
y3 = np.array(["10","20","30","40","50","60"])

#Plotting the total amount of quotes collected vs time intervals of 10 minutes
fig=plt.figure()
ax=fig.add_subplot(1,1,1)
ax.set_title("10 minutes interval graph for the number of quotes collected")
ax.set_xlabel("Time in minutes")
ax.set_ylabel("Number of quotes collected")
plt.plot(y3,x3,marker="o",markersize=10)
plt.show()

#Finding Redundant data
x0 = db.twitter_redundant.aggregate([{"$group": {"_id": {"id": "$id" },"dups": { "$addToSet": "$_id"  },"count": { "$sum": 1 }}}])
print(x0)

